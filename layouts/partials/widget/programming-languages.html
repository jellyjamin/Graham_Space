{{- $context := .Context -}}
{{- $config := .Site.Data.programming-languages -}}

{{- if and $config.enabled (eq $config.enabled true) -}}
<section class="widget tech-guide-widget">
    <div class="widget-icon">
        {{ partial "helper/icon" "code" }}
    </div>
    <h2 class="widget-title section-title">{{ $config.title }}</h2>
    {{- with $config.description }}
    <p class="widget-description">{{ . }}</p>
    {{- end }}

    <div class="tech-guide-container" 
         data-duration="{{ $config.customization.animations.duration }}"
         data-easing="{{ $config.customization.animations.easing }}"
         data-persist-state="{{ $config.customization.behavior.persistState }}"
         data-deep-linking="{{ $config.customization.behavior.deepLinking }}"
         data-keyboard-nav="{{ $config.customization.behavior.keyboardNavigation }}">
        
        {{ range $language := $config.languages }}
        <div class="tech-guide-language" 
             data-language-id="{{ $language.id }}"
             data-color="{{ $language.color }}">
            
            <!-- Language Header -->
            <div class="tech-guide-language-header">
                <!-- Main Language Title (navigates to main tutorial) -->
                <a href="{{ $language.mainNavigation.url }}" 
                   class="tech-guide-main-link"
                   aria-label="Go to {{ $language.name }} tutorial">
                    <span class="tech-guide-language-icon" style="background-color: {{ $language.color }}20; color: {{ $language.color }}">
                        {{ partial "helper/icon" $language.icon }}
                    </span>
                    <div class="tech-guide-language-info">
                        <h3 class="tech-guide-language-name">{{ $language.name }}</h3>
                        <p class="tech-guide-language-description">{{ $language.description }}</p>
                        {{- if $config.customization.styling.showDifficulty }}
                        <div class="tech-guide-meta">
                            <span class="tech-guide-difficulty difficulty-{{ lower $language.difficulty | replace " " "-" }}">
                                {{ $language.difficulty }}
                            </span>
                            {{- if $config.customization.styling.showEstimatedTime }}
                            <span class="tech-guide-time">{{ $language.estimatedTime }}</span>
                            {{- end }}
                        </div>
                        {{- end }}
                    </div>
                </a>
                
                <!-- Dropdown Toggle Button -->
                <button type="button" 
                        class="tech-guide-dropdown-toggle"
                        aria-expanded="false"
                        aria-controls="tech-guide-sections-{{ $language.id }}"
                        aria-label="Toggle {{ $language.name }} sections">
                    <svg class="tech-guide-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6,9 12,15 18,9"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Language Sections (Submenu) -->
            <div class="tech-guide-sections" 
                 id="tech-guide-sections-{{ $language.id }}"
                 role="region"
                 aria-labelledby="tech-guide-sections-{{ $language.id }}-label"
                 hidden>
                <h4 id="tech-guide-sections-{{ $language.id }}-label" class="sr-only">
                    {{ $language.name }} Tutorial Sections
                </h4>
                <ul class="tech-guide-section-list">
                    {{ range sort $language.sections "order" }}
                    <li class="tech-guide-section-item">
                        <a href="{{ .url }}" 
                           class="tech-guide-section-link"
                           data-section-id="{{ .id }}">
                            <div class="tech-guide-section-content">
                                <span class="tech-guide-section-title">{{ .title }}</span>
                                <span class="tech-guide-section-description">{{ .description }}</span>
                            </div>
                            <svg class="tech-guide-section-arrow" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12,5 19,12 12,19"></polyline>
                            </svg>
                        </a>
                    </li>
                    {{ end }}
                </ul>
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Customization Options (Hidden - for configuration) -->
    <div class="tech-guide-config" hidden>
        {{ $config.customization | jsonify }}
    </div>
</section>

<!-- Screen Reader Only Styles -->
<style>
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}
</style>
{{- end -}}