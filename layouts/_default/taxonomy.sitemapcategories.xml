{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{ range .Site.Taxonomies.categories }}
  {{- $publishedPages := where .Pages "Draft" false -}}
  {{- $pageCount := len $publishedPages -}}
  {{- if gt $pageCount 0 -}}
  {{- $priority := 0.3 -}}
  {{- $changefreq := "monthly" -}}
  
  {{- if ge $pageCount 10 -}}
    {{- $priority = 0.7 -}}
    {{- $changefreq = "weekly" -}}
  {{- else if ge $pageCount 5 -}}
    {{- $priority = 0.6 -}}
    {{- $changefreq = "monthly" -}}
  {{- else if ge $pageCount 2 -}}
    {{- $priority = 0.5 -}}
    {{- $changefreq = "monthly" -}}
  {{- else -}}
    {{- $priority = 0.4 -}}
    {{- $changefreq = "yearly" -}}
  {{- end -}}
  
  {{- $mostRecent := index $publishedPages 0 -}}
  <url>
    <loc>{{ .Page.Permalink }}</loc>
    <lastmod>{{ $mostRecent.Lastmod.Format "2006-01-02T15:04:05-07:00" }}</lastmod>
    <changefreq>{{ $changefreq }}</changefreq>
    <priority>{{ $priority }}</priority>
    {{- if .Page.IsTranslated -}}
      {{- range .Page.Translations -}}
    <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
      {{- end -}}
    <xhtml:link rel="alternate" hreflang="{{ .Page.Language.Lang }}" href="{{ .Page.Permalink }}" />
    {{- end -}}
  </url>
  {{- end -}}
  {{ end }}
</urlset>
