{{- $config := .Site.Data.programming_languages -}}

{{- if and $config $config.enabled -}}
<section class="widget tech-guide-widget">
    <div class="widget-icon">
        ðŸ“š
    </div>
    <h2 class="widget-title section-title">{{ $config.title }}</h2>
    {{- with $config.description }}
    <p class="widget-description">{{ . }}</p>
    {{- end }}

    <div class="tech-guide-container"
         data-duration="{{ $config.customization.animations.duration }}"
         data-easing="{{ $config.customization.animations.easing }}"
         data-persist-state="{{ $config.customization.behavior.persistState }}"
         data-deep-linking="{{ $config.customization.behavior.deepLinking }}"
         data-keyboard-nav="{{ $config.customization.behavior.keyboardNavigation }}">
        
        {{- range $language := $config.languages }}
        <div class="tech-guide-language" data-language-id="{{ $language.id }}">
            <!-- Language Header -->
            <div class="tech-guide-language-header">
                <!-- Main Language Title (navigates to main tutorial) -->
                <a href="{{ $language.mainNavigation.url }}" class="tech-guide-main-link" aria-label="Go to {{ $language.name }} tutorial">
                    <div class="tech-guide-language-info">
                        <h3 class="tech-guide-language-name">{{ $language.name }}</h3>
                        <p class="tech-guide-language-description">{{ $language.description }}</p>
                        <div class="tech-guide-meta">
                            <span class="tech-guide-difficulty difficulty-{{ lower $language.difficulty }}">{{ $language.difficulty }}</span>
                            <span class="tech-guide-time">{{ $language.estimatedTime }}</span>
                        </div>
                    </div>
                </a>
                
                <!-- Dropdown Toggle Button -->
                <button type="button"
                        class="tech-guide-dropdown-toggle"
                        aria-expanded="false"
                        aria-controls="tech-guide-sections-{{ $language.id }}"
                        aria-label="Toggle {{ $language.name }} sections">
                    <svg class="tech-guide-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6,9 12,15 18,9"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Language Sections (Submenu) -->
            <div class="tech-guide-sections"
                 id="tech-guide-sections-{{ $language.id }}"
                 role="region"
                 aria-labelledby="tech-guide-sections-{{ $language.id }}-label"
                 hidden>
                <h4 id="tech-guide-sections-{{ $language.id }}-label" class="sr-only">{{ $language.name }} Tutorial Sections</h4>
                <ul class="tech-guide-section-list">
                    {{- range $section := (sort $language.sections "order") }}
                    <li class="tech-guide-section-item">
                        <a href="{{ $section.url }}" class="tech-guide-section-link" data-section-id="{{ $section.id }}">
                            <div class="tech-guide-section-content">
                                <span class="tech-guide-section-title">{{ $section.title }}</span>
                                <span class="tech-guide-section-description">{{ $section.description }}</span>
                            </div>
                        </a>
                    </li>
                    {{- end }}
                </ul>
            </div>
        </div>
        {{- end }}
    </div>

    <!-- Debug info -->
    <div class="tech-guide-debug" style="font-size: 0.8em; color: #666; margin-top: 10px;">
        Widget loaded successfully with config: {{ $config.enabled }} | Languages: {{ len $config.languages }}
    </div>
</section>
{{- end -}}

<!-- Screen Reader Only Styles -->
<style>
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}
</style>
